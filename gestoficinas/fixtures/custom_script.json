[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Project", 
  "modified": "2016-11-13 12:27:25.719670", 
  "name": "Project-Client", 
  "script": "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.ui.form.on(\"Project\", {\n\tonload: function(frm) {\n\t\tvar so = frappe.meta.get_docfield(\"Project\", \"sales_order\");\n\t\tso.get_route_options_for_new_doc = function(field) {\n\t\t\tif(frm.is_new()) return;\n\t\t\treturn {\n\t\t\t\t\"customer\": frm.doc.customer,\n\t\t\t\t\"project_name\": frm.doc.name\n\t\t\t}\n\t\t}\n\n\t\tfrm.set_query('customer', 'erpnext.controllers.queries.customer_query');\n\t\t\n\t\tfrm.set_query(\"user\", \"users\", function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery:\"erpnext.projects.doctype.project.project.get_users_for_project\"\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t// sales order\n\t\tfrm.set_query('sales_order', function() {\n\t\t\tvar filters = {\n\t\t\t\t'project': [\"in\", frm.doc.__islocal ? [\"\"] : [frm.doc.name, \"\"]]\n\t\t\t};\n\n\t\t\tif (frm.doc.customer) {\n\t\t\t\tfilters[\"customer\"] = frm.doc.customer;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t});\n\t},\n\trefresh: function(frm) {\n\t\tif(frm.doc.__islocal) {\n\t\t\tfrm.web_link && frm.web_link.remove();\n\t\t} else {\n\t\t\tfrm.add_web_link(\"/projects?project=\" + encodeURIComponent(frm.doc.name));\n\n\t\t\tif(frappe.model.can_read(\"Task\")) {\n\t\t\t\tfrm.add_custom_button(__(\"Gantt Chart\"), function() {\n\t\t\t\t\tfrappe.route_options = {\"requested_by\": frm.doc.name};\n\t\t\t\t\tfrappe.set_route(\"List\", \"Task\", \"Gantt\");\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfrm.trigger('show_dashboard');\n\t\t}\n\t},\n\ttasks_refresh: function(frm) {\n\t\tvar grid = frm.get_field('tasks').grid;\n\t\tgrid.wrapper.find('select[data-fieldname=\"status\"]').each(function() {\n\t\t\tif($(this).val()==='Open') {\n\t\t\t\t$(this).addClass('input-indicator-open');\n\t\t\t} else {\n\t\t\t\t$(this).removeClass('input-indicator-open');\n\t\t\t}\n\t\t});\n\t},\n\tshow_dashboard: function(frm) {\n\t\tif(frm.doc.__onload.activity_summary.length) {\n\t\t\tvar hours = $.map(frm.doc.__onload.activity_summary, function(d) { return d.total_hours });\n\t\t\tvar max_count = Math.max.apply(null, hours);\n\t\t\tvar sum = hours.reduce(function(a, b) { return a + b; }, 0);\n\t\t\tvar section = frm.dashboard.add_section(\n\t\t\t\tfrappe.render_template('project_dashboard',\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: frm.doc.__onload.activity_summary,\n\t\t\t\t\t\tmax_count: max_count,\n\t\t\t\t\t\tsum: sum\n\t\t\t\t\t}));\n\n\t\t\tsection.on('click', '.time-sheet-link', function() {\n\t\t\t\tvar activity_type = $(this).attr('data-activity_type');\n\t\t\t\tfrappe.set_route('List', 'Timesheet',\n\t\t\t\t\t{'activity_type': activity_type, 'requested_by': frm.doc.name, 'status': [\"!=\", \"Cancelled\"]});\n\t\t\t});\n\t\t}\n\t}\n});\n\nfrappe.ui.form.on(\"Project Task\", {\n\tedit_task: function(frm, doctype, name) {\n\t\tvar doc = frappe.get_doc(doctype, name);\n\t\tif(doc.task_id) {\n\t\t\tfrappe.set_route(\"Form\", \"Task\", doc.task_id);\n\t\t} else {\n\t\t\tmsgprint(__(\"Save the document first.\"));\n\t\t}\n\t},\n\tstatus: function(frm, doctype, name) {\n\t\tfrm.trigger('tasks_refresh');\n\t},\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Order", 
  "modified": "2016-11-23 16:36:01.302950", 
  "name": "Sales Order-Client", 
  "script": "frappe.ui.form.on(\"Sales Order\",\"cambio_bna\", function(frm,cdt,cdn) {\n\n\tfrappe.call({\n\t\tasync: false,\n\t\tmethod: \"gestoficinas.gestoficinas.doctype.cambios.cambios\",\n\t\targs: {\n\t\t\t\"fonte\":\"BNA\"\t\t\t\t\n\t\t},\n\t\tcallback: function(r) {\n\t\t\ttaxavenda = r.message\n\t\t\tcur_frm.doc.taxa_cambio = taxavenda[1]\n\t\t\trefresh_field(\"taxa_cambio\")\n\t\t}\n\t});\n\n\n});\n\n\ncur_frm.cscript.custom_validate = function(doc, dt, dn) {\n\n    if (doc.docstatus == 0){\n\n\t\tif (frappe.datetime.get_day_diff(new Date(), frappe.datetime.str_to_obj(doc.transaction_date)) > 0 && doc.order_type == \"Sales\") {\n\t\t\t//Due to normal clients this have to be removed for now....\n\t\t\t//validated = false;\n\n\t\t\t//msgprint(\"Data de Ordem de Venda nao pode ser anterior de hoje\"); // or any other message you want..\n\n\t\t}\n\n\t}\t\n\n};", 
  "script_type": "Client"
 }
]